const fs=require('fs'); const axios=require('axios'); (async ()=>{ try { const html=fs.readFileSync('/Users/norton-mcintosh/GitHub/ServiceNow-2-Notion/patch/pages/pages-to-update/view-ibm-pvu-mappings-for-the-legacy-ibm-pvu-process-pack-failure-2025-12-09T07-43-16.html','utf8'); const url='http://localhost:3004/api/W2N/2c4a89fe-dba5-8133-9d04-ddd550d55bdc'; console.log('Posting to',url); const resp = await axios.patch(url, { title: 'DRYRUN Test - PVU', contentHtml: html, dryRun: true }, { headers: { 'Content-Type': 'application/json' }, timeout: 120000 }); const data = resp.data && (resp.data.data || resp.data); console.log('\n=== SUMMARY ==='); if (!data) { console.log('No data in response:', JSON.stringify(resp.data)); return; } const children = data.children || []; console.log('blocksExtracted:', data.blocksExtracted || children.length); console.log('Block types:', children.map(b=>b.type).join(', ')); console.log('\nImages found:'); children.filter(b=>b.type==='image').forEach((b,i)=>{ const src = b._sn2n_sourceUrl || (b.image && (b.image.external && b.image.external.url)) || (b.image && b.image.file_upload && b.image.file_upload.id) || 'unknown'; console.log(`${i+1}. type=image, _sn2n_sourceUrl=${src}`); }); console.log('\nFull audit.imageCount:', data.audit && data.audit.contentAnalysis && data.audit.contentAnalysis.imageCount); } catch (err) { console.error('ERROR:', err.message); if (err.response) console.error('RESP:', JSON.stringify(err.response.data).substring(0,1000)); }})();
