<div class="zDocsTopicPageBody" data-prismjs-copy="Copy" data-prismjs-copy-error="Text could not be copied. Try using keyboard shortcuts like Ctrl + C to copy instead." data-prismjs-copy-success="Copied!"><div dir="ltr" class="zDocsTopicPageBodyContent"><div><article class="hascomments" data-page="bundle:yokohama-servicenow-platform/enus/product/configuration-management/task/build-service-mapping-query.html" id="bundle:yokohama-servicenow-platform/enus/product/configuration-management/task/build-service-mapping-query.html"><main role="main"><article role="article" class="dita" id="build-service-mapping-query" aria-labelledby="title_build-service-mapping-query">
   
   
   
   <div class="body taskbody"><p class="shortdesc">The <span class="ph">Service Mapping</span> query type is a pattern consisting of classes and relationships between those classes. After you build the pattern and run the query, the query returns all the <span class="ph">Service Mapping</span> services that contain that pattern.</p>
      <section class="section prereq" id="build-service-mapping-query__prereq_jr3_h1c_4fb"><div class="tasklabel"><p class="sectiontitle tasklabel">Before you begin</p></div>
         <p class="p">Role required: cmdb_query_builder_read to only view and run saved queries, and
                cmdb_query_builder (contained for itil, itil_admin, and asset) to create and save
                queries, modify saved queries, and run queries.</p>
         <p class="p">Authorized users can update and <a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task/delete-cmdb-query.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/delete-cmdb-query.html" class="xref" title="Delete a CMDB query that is no longer used or needed.">delete</a> a
                query created by another user.</p>
      </section>
      <section class="section context"><div class="tasklabel"><p class="sectiontitle tasklabel">About this task</p></div>
         <p class="p">Build the query by dragging the CI classes that you want to include in the query,
                dropping them as nodes on the canvas, and then defining relationship properties
                between them. For every class node in the query, you can filter on its attributes to
                narrow down the results to a specific set of CIs of that class or to a single
                specific CI. You can also select which property columns appear in the query
                results.</p>
         <p class="p">As you step through building a query, list options and other user interface elements
                of the CMDB Query Builder, are dynamically filtered as appropriate to your
                selections.</p>
         <p class="p">See <a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/concept/sample-queries.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/concept/sample-queries.html" class="xref" title="Use the example queries as models for building your custom CMDB queries and Service Mapping queries.">Example queries</a> for a step-by-step walk through of building a <span class="ph">Service Mapping</span> query in the CMDB Query Builder.</p>
      </section>
      <section id="build-service-mapping-query__steps_mfz_3z1_hx"><div class="tasklabel"><p class="sectiontitle tasklabel">Procedure</p></div><ol class="ol steps" id="build-service-mapping-query__steps_mfz_3z1_hx"><li class="li step stepexpand">
            <span class="ph cmd">Navigate to <span class="ph menucascade"><span class="ph uicontrol">All</span><abbr> &gt; </abbr><span class="ph uicontrol">Configuration</span><abbr> &gt; </abbr><span class="ph uicontrol">CMDB Query Builder</span></span>.</span>
         </li><li class="li step stepexpand">
            <span class="ph cmd">On the <span class="ph uicontrol">CMDB Query Builder</span> page do either of the
                    following:</span>
            <ol type="a" class="ol substeps" id="build-service-mapping-query__substeps_ahp_4m3_tw">
               <li class="li substep substepexpand">
                  <span class="ph cmd">Select <span class="ph uicontrol">Create new</span>.</span>
               </li>
               <li class="li substep substepexpand">
                  <span class="ph cmd">Enter a <span class="ph uicontrol">Name</span>.</span>
               </li>
               <li class="li substep substepexpand">
                  <span class="ph cmd">Select <span class="ph uicontrol">Service Mapping Query</span> as the <span class="ph uicontrol">Query type</span>.</span>
               </li>
               <li class="li substep substepexpand">
                  <span class="ph cmd">Select <span class="ph uicontrol">Create</span>.</span>
               </li>
               <li class="li substep substepexpand">
                  <span class="ph cmd">Select a widget of a saved query to continue building an existing query. <a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task/search-saved-queries.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/search-saved-queries.html" class="xref" title="The CMDB Query Builder allows you to search for a specific saved query using any combination of search criteria such as the query's name, type, custom tags, and who created or updated the query.">Search for a saved query</a> first if needed.</span>
               </li>
               <li class="li substep substepexpand">
                  <span class="ph cmd">Point to the upper right corner of a saved query widget.</span>
               </li>
               <li class="li substep substepexpand">
                  <span class="ph cmd">Select the <span class="ph uicontrol">Duplicate Query</span> icon to edit a copy of a saved query.</span>
                  <div class="itemgroup info">The new query's default name contains the string 'copy'.</div>
               </li>
            </ol>
         </li><li class="li step stepexpand">
            <span class="ph cmd">On the canvas, you can do any of the following:</span>
            <div class="itemgroup info">
               <ul class="ul" id="build-service-mapping-query__ul_umc_tjd_rw">
                  <li class="li">Add CI classes to the query: Select classes from the <span class="ph uicontrol">CMDB
                                Classes</span> hierarchy list and drag them to the canvas.</li>
                  <li class="li">Add connections (relationships) between two nodes on the canvas:<ol class="ol" type="a" id="build-service-mapping-query__ol_mb1_xld_rw">
                        <li class="li">On the first node in the relationship, select the small square at
                                    the center of the right side.</li>
                        <li class="li">On the second node in the relationship, select the small square
                                    at the center of the left side to create the connection.</li>
                        <li class="li">In <span class="ph uicontrol">Connection Properties</span> on the
                                    right-side bar, configure the following (select the connection
                                    line if necessary):<ul class="ul" id="build-service-mapping-query__ul_dyt_dhp_tw">
                              <li class="li">In the Relationship Direction section, select the
                                                <span class="ph uicontrol">Parent</span> node (the
                                                <span class="ph uicontrol">Child</span> node automatically
                                            adjusts).</li>
                              <li class="li">In the Service Query Properties section, select
                                                <span class="ph uicontrol">Find Related CIs</span> or
                                                <span class="ph uicontrol">Find Unrelated CIs</span> to query
                                            for a pattern in which the two classes have or do not
                                            have relationships with each other, respectively. <p class="p">For
                                                example, <code class="ph codeph">All Tomcat WAR CIs which are not
                                                  connected to a Windows Server</code>.</p></li>
                           </ul></li>
                     </ol>
                     <div class="p"><div class="table-wrap"><table count-columns="2" class="table frame-all" id="build-service-mapping-query__table_pnh_4jp_tw"><caption><span class="table--title-label">Table 1. </span><span class="title">Relationship UI Notations</span></caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead class="thead">
                                 <tr class="row">
                                    <th class="entry colsep-1 rowsep-1" id="build-service-mapping-query__table_pnh_4jp_tw__entry__1">Notation</th>
                                    <th class="entry colsep-1 rowsep-1" id="build-service-mapping-query__table_pnh_4jp_tw__entry__2">Description</th>
                                 </tr>
                              </thead><tbody class="tbody">
                                 <tr class="row">
                                    <td class="entry colsep-1 rowsep-1" headers="build-service-mapping-query__table_pnh_4jp_tw__entry__1">Dashed line</td>
                                    <td class="entry colsep-1 rowsep-1" headers="build-service-mapping-query__table_pnh_4jp_tw__entry__2">A relationship in a <span class="ph">Service Mapping</span> query.</td>
                                 </tr>
                              </tbody></table></div></div></li>
                  <li class="li">Add filters to a class node: Apply filters to narrow down a class to a
                            specific set of CIs or to a single specific CI. <div class="p"><ol class="ol" type="a" id="build-service-mapping-query__ol_s2b_nnd_rw">
                           <li class="li">Point to the node to add a filter to, and then select the
                                            <span class="ph uicontrol">Apply filters</span> icon that pops up
                                        above the node.</li>
                           <li class="li">In the Filters section, add attribute and <a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task//csh" href="/docs/csh?topicname=create-related-list-query&amp;version=yokohama&amp;pubname=yokohama-platform-user-interface" class="xref">related list conditions</a>.</li>
                           <li class="li">Close the <span class="ph uicontrol">Filters</span> section.</li>
                        </ol>For example: Add a filter for business criticality to query for
                                businesses that are 'most critical'.</div>
                     <p class="p">Select <span class="ph uicontrol">Applied
                                    Filters</span> in the right-side bar to view all filters
                                for each node on the canvas.</p></li>
                  <li class="li">Add And/Or operators to the query: <ol class="ol" type="a" id="build-service-mapping-query__ol_uyd_3vp_rw">
                        <li class="li">Connect one node to two other nodes.</li>
                        <li class="li">Select the <span class="ph uicontrol">And</span> box that appears on the
                                    connection line, to toggle between the
                                        <span class="ph uicontrol">And</span> and the <span class="ph uicontrol">Or</span>
                                    operators.</li>
                     </ol>
                     <p class="p">For example C1 is Tomcat WAR, C2 is Linux Server, and C3 is
                                Windows Server. Query for all Tomcat WAR CIs which are connected
                                either to Linux Server Or to a Windows Server.</p></li>
                  <li class="li">Add property columns for a node, to display in the query
                                results:<div class="note note note_note"><span class="note__title">Note:</span> For a relationship, the query results display the
                                    <span class="keyword parmname">parent</span>, <span class="keyword parmname">child</span>, and
                                    <span class="keyword parmname">type</span> columns. You cannot add any other
                                columns from the [cmdb_rel_ci] table.</div>
                     <ol class="ol" type="a" id="build-service-mapping-query__ol_bhh_3qd_rw">
                        <li class="li">Select <span class="ph uicontrol">Properties</span> in the right-side
                                    pane.</li>
                        <li class="li">Select a node once or twice, so that the node's Report Columns
                                    section appears in the right-side bar, and then select
                                        <span class="ph uicontrol">Add Columns</span>.</li>
                        <li class="li">Select properties and then select outside the properties list to
                                    close it.</li>
                     </ol></li>
                  <li class="li">Select columns and add filters that will be applied to the resulting set
                            of services:<ol class="ol" type="a" id="build-service-mapping-query__ol_lfm_dgh_hx">
                        <li class="li">Select <span class="ph uicontrol">Properties</span> in the right-side bar,
                                    and then select an empty space on the canvas to ensure that
                                    nothing is selected.</li>
                        <li class="li">Select <span class="ph uicontrol">Add Columns</span> at the bottom of the
                                    right-side bar and select columns to add. Select outside the
                                    columns list to close it.</li>
                        <li class="li">Select the <span class="ph uicontrol">Apply Service Mapping Query
                                        Filters</span> icon at the top of the canvas and add
                                    filters.</li>
                     </ol></li>
                  <li class="li">Inverse the entire query and search for all <span class="ph">Service Mapping</span> services that do not include the query pattern: Select a node once or twice so that Query Properties appear in the right-side bar. In the Metadata section, toggle <span class="ph uicontrol">Services
                        Including This Pattern</span> to enable or disable the option.</li>
                  <li class="li">Add a search tag that can then be used as a search criteria for saved
                                queries:<ol class="ol" type="a" id="build-service-mapping-query__ol_sm5_1pb_4y">
                        <li class="li">Select the <span class="ph uicontrol">Add Tags</span> icon at the top of the
                                    canvas.</li>
                        <li class="li">Select <span class="ph uicontrol">Add Tag</span> and in the <span class="ph uicontrol">Query
                                        Tags</span> dialog box enter one or more tag
                                    strings.</li>
                        <li class="li">Select the <span class="ph uicontrol">Add Tags</span> icon again to close
                                    the <span class="ph uicontrol">Query Tags</span> dialog box.</li>
                     </ol></li>
               </ul>
            </div>
         </li><li class="li step stepexpand">
            <span class="ph cmd">Select <span class="ph uicontrol">Save</span>.</span>
            <div class="itemgroup info">
               <p class="p">On the <span class="ph uicontrol">Saved Queries</span> tab, point to a saved query
                        widget and select <span class="ph uicontrol">Query Information</span> to view query
                        details such as the query type, last update date, and the query
                        schedules.</p>
            </div>
         </li></ol></section>
      <section class="section postreq"><div class="tasklabel"><p class="sectiontitle tasklabel">What to do next</p></div>
         <ul class="ul" id="build-service-mapping-query__ul_jhq_hdx_rw">
            <li class="li"><p class="p">Select <span class="ph uicontrol">Run</span>.</p>
               <div class="p">The query results pane displays only the first 100 results of the query.<ul class="ul" id="build-service-mapping-query__ul_gfw_42t_w1b">
                     <li class="li">Select <span class="ph uicontrol">Load More Results</span> to display the next
                                set of 100 results.</li>
                     <li class="li">Select <span class="ph uicontrol">Load All Results</span> to display the rest of
                                the query results, up to the number specified by the <a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/reference/cmdb-querybldr-sysproprties.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/reference/cmdb-querybldr-sysproprties.html" class="xref" title="Set property values to configure query processing.">glide.cmdb.query.max_results_limit</a> system property
                                (10,000 by default).</li>
                  </ul></div>
               <p class="p">Select a CI to open its CI form, and on the CI form select <span class="ph uicontrol">Open in CMDB Workspace</span> to view CI health in the CI Health tile in CMDB Workspace. This operation requires the sn_cmdb_user (CMDB user)
                  role.</p>
               <div class="note note note_note"><span class="note__title">Note:</span> When a query is running, wait for it to complete or to time out before
                        opening or running another query.</div></li>
            <li class="li"><a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task/cmdb-querybldr-config-display.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/cmdb-querybldr-config-display.html" class="xref" title="Configure settings that control some of the functionality of the CMDB Query Builder.">Modify Query Builder settings</a>: Select the Settings icon (<img src="https://servicenow-be-prod.servicenow.com/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/../../business-service-management-map-ng/image/dv-map-settings.png?_LANG=enus" class="image icon" id="build-service-mapping-query__image_x3w_sfg_nfb" alt="Settings icon.">) icon to open the <span class="ph uicontrol">Query Builder Settings</span> dialog box.</li>
            <li class="li">Copy and share the URL of a saved query with users that have access to the CMDB
                    Query Builder. Pasting the shared URL in a new internet browser window, directly
                    opens the saved query in the CMDB Query Builder.</li>
            <li class="li"><a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/concept/create-query-results-report.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/concept/create-query-results-report.html" class="xref" title="Use CMDB Query Builder reports to show the results of a CMDB query or a Service Mapping query. Create a basic report or a dynamic report that auto-updates when the results of the associated saved query change.">Create a report in CMDB Query Builder</a>.</li>
            <li class="li"><a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task/create-cmdb-query-schedule.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/create-cmdb-query-schedule.html" class="xref" title="Schedule a saved CMDB query to run once at a scheduled time or on a recurring schedule, and to email the query results to specified users.">Create a schedule</a> to run the query at a future
                    time, and to email the results to interested parties.</li>
            <li class="li">Export query results: <p class="p">Export query results that are visible: Select the Query
                        Results context menu and select <span class="ph uicontrol">Export</span>. Even if the
                            <span class="ph uicontrol">Load More Results</span> button is visible, indicating
                        that there are additional query results, only the results that are visible
                        are exported.</p></li>
            <li class="li"><a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task/export-import-query.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/export-import-query.html" class="xref" title="Export a saved CMDB or Service Mapping query definition to an XML file which you can later import and run in the CMDB Query Builder. This process lets you port a saved query between instances, such as from a development environment to a production environment.">Export and import a CMDB query</a> to port a query definition between
                    instances.</li>
            <li class="li"><a data-bundleid="yokohama-servicenow-platform" data-navpath="Chunk517911533.html" href="/docs/bundle/yokohama-servicenow-platform/page/Chunk517911533.html#populate-cmdb-grp-saved-query" class="xref" title="Depending on the group type, you can populate a CMDB group by manually adding individual CIs, selecting saved CMDB queries, or building encoded queries in the CMDB group itself. The resulting CIs from each query are added as members to the group.">Populate a CMDB group</a>
                    using the saved query.</li>
            <li class="li"><a data-bundleid="yokohama-servicenow-platform" data-navpath="product/configuration-management/task/delete-cmdb-query.html" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/task/delete-cmdb-query.html" class="xref" title="Delete a CMDB query that is no longer used or needed.">Delete a CMDB query</a>.</li>
         </ul>
      </section>
   </div>
   <nav role="navigation"></nav><nav role="navigation" class="tasksNavigation"></nav>
</article></main></article></div></div><div class="contentPlaceholder stickToBottom" style="height: 0px;"><div class="contentContainer zDocsSideBoxes withExpandCollapse undefined" style="top: -323px;"><div class="contentWrapper" style="height: 0px;"><button aria-hidden="true" data-tooltip-id="zDocsMiniTocCollapseToolTip" data-tooltip-content="Hide Mini TOC" data-testid="expand-collapse-button" class="zDocsMiniTocCollapseButton" aria-label="Hide" aria-expanded="true"><svg aria-hidden="true" class="ico-angle-arrow-right"><use xlink:href="#ico-angle-arrow-right"></use></svg></button><div><h5 class=" css-g931ng" aria-level="5">Related Content</h5><ul><li><a class=" css-ettsdk" stylesprops="[object Object]" href="/docs/bundle/yokohama-servicenow-platform/page/product/configuration-management/concept/sample-queries.html"><svg class="ico-related-link" aria-hidden="true"><use xlink:href="#ico-related-link"></use></svg>Example queries</a><p>Use the example queries as models for building your custom CMDB queries and Service Mapping queries.</p></li></ul></div></div></div></div></div>